---
import { loadContent } from '../utils/content';

interface Props {
  scheduleUrl?: string;
}

const { scheduleUrl } = Astro.props;
const bookingHref = scheduleUrl ?? '#booking';
const bookingAttrs = scheduleUrl
  ? { target: '_blank', rel: 'noopener noreferrer' }
  : {};

const { frontmatter } = loadContent('services.md');

function requireString(key: string) {
  const value = frontmatter[key] as unknown;
  if (typeof value !== 'string' || value.trim().length === 0) {
    throw new Error(`content/services.md is missing required frontmatter key: ${key}`);
  }
  return value;
}

function requireStringList(key: string) {
  const value = frontmatter[key] as unknown;
  if (!Array.isArray(value) || value.length === 0 || value.some((v) => typeof v !== 'string' || v.trim().length === 0)) {
    throw new Error(`content/services.md is missing required frontmatter list: ${key}`);
  }
  return value as string[];
}

const cardTitle = requireString('subtitle');
const summary = requireString('summary');
const format = requireString('format');
const duration = requireString('duration');
const price = requireString('price');
const featuresTitle = requireString('featuresTitle');
const ctaNote = requireString('ctaNote');
const ctaLabel = requireString('ctaLabel');
const features = requireStringList('features');
---

<section id="services" class="py-12 sm:py-24 px-4 bg-warm-beige">
  <div class="max-w-3xl mx-auto">
    <div class="reveal bg-warm-white rounded-2xl border border-sage/15 border-t-3 border-t-sage/40 overflow-hidden">
      <div class="p-6 sm:p-10">
        <h2 class="font-heading text-2xl sm:text-3xl font-semibold text-warm-gray mb-2">
          {cardTitle}
        </h2>
        <p class="text-warm-gray-light leading-relaxed mb-6 text-[0.95rem]">
          {summary}
        </p>

        <div class="flex flex-wrap gap-x-6 gap-y-2.5 mb-6 pb-6 border-b border-sage/10">
          <div class="flex items-center gap-2.5 text-sm">
            <svg class="w-4 h-4 text-sage-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
            <span class="text-warm-gray-light"><span class="text-warm-gray font-medium">Формат:</span> {format}</span>
          </div>
          <div class="flex items-center gap-2.5 text-sm">
            <svg class="w-4 h-4 text-sage-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span class="text-warm-gray-light"><span class="text-warm-gray font-medium">Длительность:</span> {duration}</span>
          </div>
          <div class="flex items-center gap-2.5 text-sm">
            <svg class="w-4 h-4 text-sage-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
            <span class="text-warm-gray-light"><span class="text-warm-gray font-medium">Стоимость:</span> {price}</span>
          </div>
        </div>

        <h3 class="font-heading text-lg font-semibold text-warm-gray mb-4">{featuresTitle}</h3>
        <ul class="space-y-3">
          {features.map((feature, i) => (
            <li class={`reveal flex items-start gap-3 ${i > 0 ? `reveal-delay-${Math.min(i, 3)}` : ''}`}>
              <svg class="w-5 h-5 text-sage shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
              <span class="text-warm-gray-light text-[0.95rem]">{feature}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="bg-sage/8 px-6 sm:px-10 py-5 sm:py-6 flex flex-col sm:flex-row items-center justify-between gap-4">
        <p class="text-warm-gray-light text-sm text-center sm:text-left">
          {ctaNote}
        </p>
        <a
          href={bookingHref}
          {...bookingAttrs}
          class="inline-flex items-center gap-2 bg-sage hover:bg-sage-dark text-white px-7 py-3 rounded-full text-sm font-medium tracking-wide transition-all duration-300 hover:shadow-lg hover:shadow-sage/25 hover:-translate-y-0.5 shrink-0"
        >
          {ctaLabel}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
        </a>
      </div>
    </div>
  </div>
</section>
